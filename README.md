# PawGuardian - Pet Safety Agent ğŸ¾

[![Deploy to Cloud Run](https://deploy.cloud.run/button.svg)](https://paw-guardian-576306226088.asia-northeast1.run.app/)

**è»Šå†…ã«æ®‹ã•ã‚ŒãŸãƒšãƒƒãƒˆã®ç†±ä¸­ç—‡ã‚„åˆ†é›¢ä¸å®‰ã‚’è‡ªå¾‹çš„ã«é˜²ãã€Agentic AI ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ **  
**An autonomous monitoring system powered by Agentic AI to prevent heatstroke and anxiety for pets left in vehicles.**

![](https://storage.googleapis.com/zenn-user-upload/9eded380a82e-20260215.png)

---

## ğŸŒŸ æ¦‚è¦ / Overview

**PawGuardian** ã¯ã€Google Cloud ã® **Vertex AI Gemini 2.5 Flash** ã‚’æ­è¼‰ã—ãŸã€Œè‡ªå¾‹å‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€ã§ã™ã€‚å˜ãªã‚‹ç›£è¦–ã‚«ãƒ¡ãƒ©ã§ã¯ãªãã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®å‹•ç”»è§£æã¨ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’çµ„ã¿åˆã‚ã›ã€ãƒšãƒƒãƒˆã®ç•°å¸¸ã‚’æ¤œçŸ¥ã—ãŸéš›ã«è‡ªå¾‹çš„ã«ä»‹å…¥ï¼ˆé€šå ±ãƒ»éŸ³æ¥½å†ç”Ÿãƒ»ç’°å¢ƒæ“ä½œï¼‰ã‚’è¡Œã„ã¾ã™ã€‚

---

## ğŸ¤– ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼šReAct ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹ 2 ã¤ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

PawGuardian ã¯ **Agentic Reasoning (ReAct ãƒ‘ã‚¿ãƒ¼ãƒ³)** ã‚’æ¡ç”¨ã—ã€ä»¥ä¸‹ã® 2 ã¤ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ï¼š

### Agent 1: Observer (è¦–è¦šåˆ†æã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ)

**å½¹å‰²**: å‹•ç”»ã‹ã‚‰å®¢è¦³çš„ãªäº‹å®Ÿã‚’æŠ½å‡ºã—ã€ãƒšãƒƒãƒˆã®çŠ¶æ…‹ã‚’åˆ¤å®š

**æ¤œå‡ºé …ç›®**:
- âœ… ãƒšãƒƒãƒˆã®æœ‰ç„¡ï¼ˆ**æ—©æœŸçµ‚äº†ãƒ­ã‚¸ãƒƒã‚¯**: ãƒšãƒƒãƒˆãŒæ¤œå‡ºã•ã‚Œãªã„å ´åˆã€å³åº§ã«ç›£è¦–ã‚’ä¸­æ­¢ã—ã¦ API ã‚³ã‚¹ãƒˆã‚’å‰Šæ¸›ï¼‰
- ğŸ“Š ä¸å®‰ãƒ¬ãƒ™ãƒ«ã® 3 æ®µéšåˆ†é¡

**ä¸å®‰ãƒ¬ãƒ™ãƒ«ã®å…·ä½“çš„ãªå®šç¾©**:

| ãƒ¬ãƒ™ãƒ« | çŠ¶æ…‹ | è¡Œå‹•ç‰¹æ€§ |
|-------|------|--------|
| **Relax** | å®‰å…¨ | é™ã‹ã«åº§ã£ã¦ã„ã‚‹ã€æ¢ç´¢è¡Œå‹•ãªã—ã€ä½“ãŒãƒªãƒ©ãƒƒã‚¯ã‚¹ |
| **Low Anxiety** | æ³¨æ„ | é¼»ã‚’ãªã‚ã‚‹ã€è€³ãŒå¾Œã‚ã¸ã€è½ã¡ç€ããªããã‚ãã‚ |
| **High Anxiety** | è­¦å‘Š | çª“ã‚’ã²ã£ã‹ãã€æ¿€ã—ã„æ¯é£ã„ã€ç¶™ç¶šçš„ãªå ãˆ |

**å‡ºåŠ›ä¾‹** (JSON ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ):
```json
{
  "subject_detected": true,
  "anxiety_level": "Low",
  "observations": "çŠ¬ã¯ä¸å®‰ãã†ã«è»Šå†…ã‚’è¦‹å›ã£ã¦ã„ã¾ã™",
  "stress_signs": ["é¼»ã‚’ãªã‚ã‚‹", "ãã‚ãã‚ã—ãŸå‹•ã"]
}
```

**æ—©æœŸçµ‚äº†ã®æµã‚Œ**:
```python
if not obs_data.get("subject_detected"):
    # ãƒšãƒƒãƒˆãŒæ¤œå‡ºã•ã‚Œãªã„å ´åˆ
    â†’ è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
    â†’ ç›£è¦–å®Œäº†ï¼ˆAgent 2 ã¯å®Ÿè¡Œã•ã‚Œãªã„ï¼‰
    â†’ å‡¦ç†ä¸­æ­¢ (st.stop())
    â†’ API ã‚³ã‚¹ãƒˆå‰Šæ¸› âœ…
```

---

### Agent 2: Decision Maker + Tool Executor (åˆ¤æ–­ã¨å®Ÿè¡Œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ)

**å½¹å‰²**: Observer ã®çµæœã€ãƒšãƒƒãƒˆæƒ…å ±ï¼ˆçŠ¬ç¨®ãƒ»å¹´é½¢ãƒ»æ—¢å¾€ç—‡ï¼‰ã€è»Šå†…æ¸©åº¦ã‚’çµ±åˆã—ã¦ã€ãƒªã‚¹ã‚¯è©•ä¾¡ã¨å¯¾å¿œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ±ºå®šãƒ»å®Ÿè¡Œ

**åˆ¤æ–­ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆ5 ã¤ã®ã‚»ãƒ¼ãƒ•ãƒ†ã‚£ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼‰**:

```
Protocol 1: é«˜æ¸©å±æ©Ÿ
  IF subject_detected = true AND æ¸©åº¦ > 35Â°C
  â†’ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ã€é€šå ±ã€‘+ ã€çª“ã‚’å…¨é–‹ã€‘

Protocol 2: çŸ­é ­ç¨®ç‰¹åˆ¥å¯¾å¿œ
  IF subject_detected = true AND çŠ¬ç¨® = Brachycephalic AND æ¸©åº¦ > 30Â°C
  â†’ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ã€é€šå ±ã€‘

Protocol 3: é«˜åº¦ã®ä¸å®‰
  IF subject_detected = true AND ä¸å®‰ãƒ¬ãƒ™ãƒ« = 'High'
  â†’ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ã€é€šå ±ã€‘

Protocol 4: è»½åº¦ã®ä¸å®‰ï¼ˆã‚±ã‚¢å¯¾å¿œï¼‰
  IF subject_detected = true AND ä¸å®‰ãƒ¬ãƒ™ãƒ« = 'Low'
  â†’ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ã€ãƒªãƒ©ãƒƒã‚¯ã‚¹éŸ³æ¥½å†ç”Ÿã€‘+ ã€SMS é€šçŸ¥ã€‘

Protocol 5: å®‰å…¨çŠ¶æ…‹ï¼ˆéä»‹å…¥ï¼‰â­ é‡è¦
  IF subject_detected = true AND ä¸å®‰ãƒ¬ãƒ™ãƒ« = 'Relax' AND æ¸©åº¦ < 30Â°C
  â†’ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ãªã—ï¼ˆæœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆ: "ãƒšãƒƒãƒˆã¯å®‰å…¨ã§ã™"ï¼‰
```

**é‡è¦**: Protocol 5 ã«ã‚ˆã‚Šã€ä¸è¦ãªä»‹å…¥ã¨ API ã‚³ã‚¹ãƒˆã®ç„¡é§„ã‚’é˜²æ­¢

---

## ğŸ”§ 4 ã¤ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œãƒ„ãƒ¼ãƒ«

Agent 2 ã®åˆ¤æ–­ã«åŸºã¥ãã€ä»¥ä¸‹ã® **4 ã¤ã®ãƒ„ãƒ¼ãƒ«** ãŒè‡ªå‹•çš„ã«å®Ÿè¡Œã•ã‚Œã¾ã™ï¼š

| ãƒ„ãƒ¼ãƒ« | æ©Ÿèƒ½ | API | ç”¨é€” |
|-------|------|-----|------|
| **send_sms_alert** | SMS é€ä¿¡ | Twilio Messages | è»½åº¦ã®ä¸å®‰ã‚’é£¼ã„ä¸»ã«é€šçŸ¥ |
| **make_emergency_call** | ç·Šæ€¥é€šè©± | Twilio Voice | ãƒšãƒƒãƒˆã®ç·Šæ€¥æ™‚ã«é£¼ã„ä¸»ã«é€šå ±ï¼ˆæ—¥æœ¬èªéŸ³å£°ï¼‰ |
| **open_car_windows** | çª“é–‹æ”¾åˆ¶å¾¡ | äºˆç´„å¯èƒ½ | é«˜æ¸©æ™‚ã«è»Šå†…æ¸©åº¦ã‚’ä½ä¸‹ (0-100%) |
| **play_music** | éŸ³æ¥½å†ç”Ÿ | Pixabay Audio | ãƒªãƒ©ãƒƒã‚¯ã‚¹éŸ³æ¥½ã¾ãŸã¯ãƒ›ãƒ¯ã‚¤ãƒˆãƒã‚¤ã‚ºã§ä¸å®‰ã‚’è»½æ¸› |

**ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã®ä¾‹**:
```python
# ä½åº¦ã®ä¸å®‰ãŒæ¤œå‡ºã•ã‚ŒãŸå ´åˆ
send_sms_alert(message="ãƒšãƒƒãƒˆãŒä¸å®‰ãã†ã§ã™")
play_music(track_type="ãƒªãƒ©ãƒƒã‚¯ã‚¹")

# é«˜æ¸©+æ¤œå‡ºæ™‚
make_emergency_call(message="è»Šå†…æ¸©åº¦ãŒ35åº¦ã‚’è¶…ãˆã¦ã„ã¾ã™")
open_car_windows(level=100)
```

---

## âœ¨ ä¸»ãªç‰¹å¾´ / Features

### 1. **è‡ªå¾‹çš„ãªæ„æ€æ±ºå®š**
- ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«å…¥åŠ›ï¼ˆå‹•ç”» + æ¸©åº¦ã‚»ãƒ³ã‚µãƒ¼ï¼‰ã«ã‚ˆã‚‹é«˜åº¦ãªãƒªã‚¹ã‚¯åˆ¤æ–­
- JSON ãƒ™ãƒ¼ã‚¹ã®æ§‹é€ åŒ–å‡ºåŠ›ã§ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã®æƒ…å ±ä¼é”ã‚’æœ€é©åŒ–
- **Temperature = 0.0** ã§ã®æ±ºå®šæ€§æ¨è«–ã«ã‚ˆã‚Šã€å®‰å…¨æ€§ã‚’æœ€å¤§åŒ–

### 2. **ã‚³ã‚¹ãƒˆãƒ»å®‰å…¨æ€§ã®æœ€é©åŒ–**
- **æ—©æœŸçµ‚äº†ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆEarly Exitï¼‰**: ãƒšãƒƒãƒˆãŒæ¤œå‡ºã•ã‚Œãªã„å ´åˆã€Agent 2 ã‚’å®Ÿè¡Œã›ãš API ã‚³ã‚¹ãƒˆã‚’å‰Šæ¸›
- **ãƒ—ãƒ­ãƒˆã‚³ãƒ« 5**: å®‰å…¨çŠ¶æ…‹ã§ã¯ä¸€åˆ‡ã®ä»‹å…¥ã‚’è¡Œã‚ãªã„
- çµæœ: ä¸è¦ãª API å‘¼ã³å‡ºã—ã‚’æœ€å°åŒ–ã—ãªãŒã‚‰ã€çœŸã®å±æ©Ÿã«ã¯è¿…é€Ÿã«å¯¾å¿œ

### 3. **ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸå®‰å…¨åŸºæº–**
é£¼ã„ä¸»ãŒä»¥ä¸‹ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ï¼š

| è¨­å®šé …ç›® | ç¯„å›² | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|--------|------|---------|------|
| ãƒšãƒƒãƒˆå | ä»»æ„ | "Lucky" | ãƒšãƒƒãƒˆã®è­˜åˆ¥å |
| çŠ¬ç¨® | è¤‡æ•°é¸æŠ | ã‚³ãƒ¼ã‚®ãƒ¼ | çŠ¬ç¨®åˆ¥ã®è‡ªå‹•èª¿æ•´ã‚ã‚Š |
| å¹´é½¢ | 0.5-20 æ­³ | 4.5 | ã‚·ãƒ‹ã‚¢çŠ¬åˆ¤å®šï¼ˆ>10 æ­³ï¼‰ã«ä½¿ç”¨ |
| ä½“é‡ | 5-30 kg | 13.5 | ãƒªã‚¹ã‚¯è©•ä¾¡ã®å‚è€ƒå€¤ |
| æ—¢å¾€ç—‡ | ãƒ†ã‚­ã‚¹ãƒˆ | ç©º | å€‹åˆ¥ãƒªã‚¹ã‚¯è¦å› ï¼ˆä¾‹: æ°—ç®¡è™šè„±ï¼‰ |
| **ä¸å®‰æ„Ÿåº¦** | 1-10 | 8 | **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„Ÿåº¦è¨­å®š** |

**è‡ªå‹•èª¿æ•´ãƒ«ãƒ¼ãƒ«**:
- ğŸ• **çŸ­é ­ç¨®** (ãƒ•ãƒ¬ãƒ³ãƒãƒ–ãƒ«ãƒ‰ãƒƒã‚°ã€ãƒ‘ã‚°): æ¸©åº¦é–¾å€¤ **-5Â°C** (35Â°C â†’ 30Â°C)
- ğŸ‘´ **ã‚·ãƒ‹ã‚¢çŠ¬** (å¹´é½¢ > 10 æ­³): ä¸å®‰åå¿œã®æ¤œçŸ¥æ„Ÿåº¦ **UP**

### 4. **ã‚»ã‚­ãƒ¥ã‚¢è¨­è¨ˆ**
- **Google Secret Manager**: Twilio API ã‚­ãƒ¼ãªã©ã®ç§˜åŒ¿æƒ…å ±ã‚’å®‰å…¨ã«ç®¡ç†
- **Signed URL (V4)**: IAM èªè¨¼ã«ã‚ˆã‚‹ Google Cloud Storage ä¸Šã®å‹•ç”»ã¸ã®ã‚»ã‚­ãƒ¥ã‚¢ã‚¢ã‚¯ã‚»ã‚¹
- **ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ¨©é™**: æœ€å°æ¨©é™ã®åŸå‰‡ã«åŸºã¥ã„ãŸ IAM è¨­å®š
- **CORS è¨­å®š**: Google Cloud Storage ä¸Šã®å‹•ç”»ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã«å¯¾å¿œ

---

## ğŸ›  æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ / Tech Stack

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | æŠ€è¡“ |
|--------|------|
| **Frontend/UI** | Streamlit (Python Web Framework) |
| **AI ã‚¨ãƒ³ã‚¸ãƒ³** | Vertex AI Gemini 2.5 Flash (asia-northeast1 ãƒªãƒ¼ã‚¸ãƒ§ãƒ³) |
| **LLM è¨­å®š** | Temperature = 0.0ï¼ˆæ±ºå®šæ€§æ¨è«–ï¼‰ |
| **ã‚¯ãƒ©ã‚¦ãƒ‰åŸºç›¤** | Google Cloud Run, Cloud Storage, Secret Manager |
| **é€šä¿¡ API** | Twilio Voice API, Twilio SMS API |
| **ãƒ‡ãƒ—ãƒ­ã‚¤** | Docker (Python 3.11-slim) |
| **ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª** | google-cloud-aiplatform, google-cloud-storage, twilio, python-dotenv |

---

## ğŸ“Š å®Ÿè¡Œæ–¹æ³• / Setup & Execution

### Prerequisites / å‰ææ¡ä»¶

- Google Cloud ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆVertex AI API, Secret Manager API ã‚’æœ‰åŠ¹åŒ–ï¼‰
- Twilio ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆç„¡æ–™ãƒˆãƒ©ã‚¤ã‚¢ãƒ«å¯ï¼‰
- Python 3.11 ä»¥ä¸Š
- gcloud CLI

---

### 2ï¸âƒ£ ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰

#### ğŸ macOS ã®å ´åˆ

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/song4wk/PawGuardian.git
cd PawGuardian

# Python ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆ
python3 -m venv venv
source venv/bin/activate

# ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install --upgrade pip
pip install -r requirements.txt

# Google Cloud èªè¨¼
gcloud auth application-default login

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•
streamlit run app.py
```

#### ğŸªŸ Windows ã®å ´åˆ

```powershell
# ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/song4wk/PawGuardian.git
cd PawGuardian

# Python ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆ
python -m venv venv
.\venv\Scripts\activate

# ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install --upgrade pip
pip install -r requirements.txt

# Google Cloud èªè¨¼
gcloud auth application-default login

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•
streamlit run app.py
```

#### ğŸ§ Linux ã®å ´åˆ

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/song4wk/PawGuardian.git
cd PawGuardian

# Python ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆ
python3 -m venv venv
source venv/bin/activate

# ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install --upgrade pip
pip install -r requirements.txt

# Google Cloud èªè¨¼
gcloud auth application-default login

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•
streamlit run app.py
```



---

## ğŸ“š å‚è€ƒè³‡æ–™

- [Google Cloud Vertex AI ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://cloud.google.com/vertex-ai/docs)
- [Gemini API é–¢æ•°å‘¼ã³å‡ºã—ï¼ˆFunction Callingï¼‰](https://ai.google.dev/docs/function_calling)
- [Streamlit ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.streamlit.io/)
- [Twilio Python SDK](https://www.twilio.com/docs/python/install)
- [Google Cloud Secret Manager](https://cloud.google.com/secret-manager/docs)